<!doctype html>
<html lang="en" data-baseline="stable-2025-10-01__rails-460px__galC-6-only">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gardenicity ‚Äî Hero ‚Üí S1 ‚Üí S2 ‚Üí gallery-A-Left ‚Üí S3 ‚Üí S4 ‚Üí MapA ‚Üí S5 ‚Üí gallery-B-Center ‚Üí S8 ‚Üí S9 ‚Üí gallery-C-Right ‚Üí S11 ‚Üí S12 ‚Üí S13 ‚Üí S14 ‚Üí S15</title>

<script src='https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.css' rel='stylesheet' />

<style>

/* ===== Base (UNCHANGED) ===== */
html,body{
margin:0; padding:0; height:100%;
background:#f8fbf2; color:#fff;
font-family:"Acumin Pro",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
}
:root{
/* HERO */
--shift:0px; --titleOpacity:0; --linksOpacity:0; --heroAlpha:1; --heroBlur:0;
/* S1 */
--s1:0; --s1Overlay:0; --s1Y:0px; --s1ImgOpacity:0;
/* S2 */
--s2:0; --s2Overlay:0; --s2Y:0px; --s2ImgOpacity:0;
/* gallery-A-Left */
--galA:0;
--galAImg0Opacity:0; --galAImg1Opacity:0; --galAImg2Opacity:0; --galAImg3Opacity:0;
--galAReady:0;
/* S3 (full bleed) */
--s3:0; --s3ImgOpacity:0; --s3Scale:1;
/* S4 */
--s4:0; --s4Overlay:0; --s4Y:0px; --s4ImgOpacity:0;
/* NEW MAP SECTION */
--sMapA:0; --sMapAImgOpacity:0; 
/* ‚ùå REMOVED --mapActive */
/* S5 */
--s5:0; --s5Overlay:0; --s5Y:0px; --s5ImgOpacity:0;
/* ... (rest of variables) ... */
}

/* ‚ùå REMOVED: body.body-locked { overflow: hidden !important; } */

/* ... (Hero, S1, S2, GalA, S3, S4 frame styles remain here) ... */

/* MapA full-bleed - CRITICAL STYLES */
.sMapA-frame{
    top:0; right:0; bottom:0; left:0;
    opacity:var(--sMapAImgOpacity);
    z-index: 1; 
}
/* üü¢ Map container element */
#mapbox-gl-container{
    width:100%; height:100%;
    /* Mapbox GL JS handles interaction, no pointer-events: none needed */
}

/* ‚ùå REMOVED: all .map-overlay and .exit-map-btn CSS */

/* ... (S5 through S15 frame and overlay styles remain here) ... */

/* ===== SECTION DRIVERS (MapA added) ===== */
.s1-wrap, .s2-wrap, .galA-left-wrap, .s3-wrap, .s4-wrap, .s5-wrap,
.sMapA-wrap, /* NEW */
.galB-center-wrap, .s8-wrap, .s9-wrap, .galC-left-wrap, .s11-wrap, .s12-wrap,
.s13-wrap, .s14-wrap, .s15-wrap{
position:relative; height:280vh; background:#f8fbf2;
}

/* ... (TEXT OVERLAYS and MOBILE/TABLET RESPONSIVE styles remain here) ... */
@media (max-width:1023px){
    .frame.sMapA-frame {
        left:0 !important; right:0 !important; top:0 !important; bottom:0 !important;
    }
}
</style>
</head>
<body>

<div class="hero-fixed" id="hero">...</div>
<section class="driver" id="driver"></section>
<figure class="frame s1-frame" aria-hidden="true"><img id="s1-img" src="assets/section1.jpg" alt=""></figure>
<section class="s1-wrap" id="s1-wrap"></section>
<div class="s1-overlay">...</div>
<figure class="frame s2-frame" aria-hidden="true"><img id="s2-img" src="assets/section2.jpg" alt=""></figure>
<section class="s2-wrap" id="s2-wrap"></section>
<div class="s2-overlay">...</div>
<figure class="frame galA-left-frame" aria-hidden="true">...</figure>
<section class="galA-left-wrap" id="galA-wrap"></section>
<figure class="frame s3-frame" aria-hidden="true"><img id="s3-img" src="assets/section3.jpg" alt=""></figure>
<section class="s3-wrap" id="s3-wrap"></section>
<figure class="frame s4-frame" aria-hidden="true"><img id="s4-img" src="assets/section4.jpg" alt=""></figure>
<section class="s4-wrap" id="s4-wrap"></section>
<div class="s4-overlay">...</div>

<figure class="frame sMapA-frame" aria-hidden="true" id="map-frame-container">
    <div id="mapbox-gl-container"></div>
</figure>
<section class="sMapA-wrap" id="sMapA-wrap"></section>
<figure class="frame s5-frame" aria-hidden="true"><img id="s5-img" src="assets/section5.jpg" alt=""></figure>
<section class="s5-wrap" id="s5-wrap"></section>
<div class="s5-overlay">...</div>
<section class="after"></section>

<script>
(function(){
const root=document.documentElement;
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const easeInOutCubic=t=>t<0.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;
const easePow=(t,p)=>Math.pow(t,p);

/* ... (All measurement functions and helper functions remain here) ... */

function progressOf(el){
const r=el.getBoundingClientRect();
const vh=window.innerHeight||document.documentElement.clientHeight;
const total=r.height-vh;
if(total<=0) return 0;
return clamp(-r.top/total,0,1);
}

/* ---------- WRAPS ---------- */
// Define ALL wraps used in the update function
const s1Wrap=document.getElementById('s1-wrap');
const s2Wrap=document.getElementById('s2-wrap');
const galAWrap=document.getElementById('galA-wrap');
const s3Wrap=document.getElementById('s3-wrap');
const s4Wrap=document.getElementById('s4-wrap');
const sMapAWrap=document.getElementById('sMapA-wrap'); /* MAP WRAP */
const s5Wrap=document.getElementById('s5-wrap');
const galBWrap=document.getElementById('galB-wrap');
const s8Wrap=document.getElementById('s8-wrap');
const s9Wrap=document.getElementById('s9-wrap');
const galCWrap=document.getElementById('galC-wrap');
const s11Wrap=document.getElementById('s11-wrap');
const s12Wrap=document.getElementById('s12-wrap');
const s13Wrap=document.getElementById('s13-wrap');
const s14Wrap=document.getElementById('s14-wrap');
const s15Wrap=document.getElementById('s15-wrap');

/* ... (All text variables, measureS functions, and load gates remain here) ... */

/* üü¢ MAPBOX GL JS GLOBAL VARIABLE */
let map = null; 

/* ‚ùå REMOVED: enterMapInteraction, exitMapInteraction, and their event listeners */

function update(){
/* ... (All existing HERO choreography, s1 through s15 progress calculations remain here) ... */
const s1=progressOf(s1Wrap);
const s2=progressOf(s2Wrap);
const galA=progressOf(galAWrap);
const s3=progressOf(s3Wrap);
const s4=progressOf(s4Wrap);
const sMapA=progressOf(sMapAWrap); /* NEW */
const s5=progressOf(s5Wrap);
const galB=progressOf(galBWrap);
const s8=progressOf(s8Wrap);
const s9=progressOf(s9Wrap);
const galC=progressOf(galCWrap);
const s11=progressOf(s11Wrap);
const s12=progressOf(s12Wrap);
const s13=progressOf(s13Wrap);
const s14=progressOf(s14Wrap);
const s15=progressOf(s15Wrap);
// ... (rest of progress variables) ...

root.style.setProperty('--sMapA',sMapA.toFixed(3)); /* MAP */

/* ... (All existing overlays, text sweeps, end zooms logic remain here) ... */

/* ===== Crossfades (standardized) ===== */
const FADE_FRAC = 0.35;
const LEAD_FRAC = 0.15;

/* ... (S1‚ÜíS2, S2‚ÜíGalA, GalA‚ÜíS3, S3‚ÜíS4 logic remains here) ... */

/* S4 ‚Üí MapA */
const x4MapA = clamp(sMapA/FADE_FRAC, 0, 1);
const s4AlphaIn = x34; // Assuming x34 is calculated earlier
let sMapAAlphaIn = x4MapA;
let s4Alpha = s4AlphaIn * (1 - x4MapA); 

/* MapA ‚Üí S5 */
const xMapA5 = clamp(s5/FADE_FRAC, 0, 1);
const sMapAAlphaOut = sMapAAlphaIn * (1 - xMapA5); 

/* üü¢ Map Control Logic (New seamless map control) */
if (map) {
    const scrollProgress = clamp(sMapA, 0, 1); // Use raw progress of the map section wrapper
    
    // START POSITION: Zoom=16.0, Center=[34.770081, 32.079031]
    // END POSITION:   Zoom=15.5, Center=[34.775081, 32.075031]

    const startZoom = 16.0;
    const endZoom = 15.5;
    const currentZoom = startZoom + (endZoom - startZoom) * scrollProgress;
    
    const startCenter = [34.770081, 32.079031]; 
    const endCenter = [34.775081, 32.075031]; 
    
    const currentLon = startCenter[0] + (endCenter[0] - startCenter[0]) * scrollProgress;
    const currentLat = startCenter[1] + (endCenter[1] - startCenter[1]) * scrollProgress;

    // Use jumpTo to prevent flickering/fading, and map.setCenter for smooth pan/zoom
    map.setZoom(currentZoom);
    map.setCenter([currentLon, currentLat]);
}
/* ----------------------------------------------- */

/* ... (rest of crossfade logic S5 through S15 remains here) ... */

/* ===== Apply section frame opacities ===== */
root.style.setProperty('--s1ImgOpacity', s1Alpha.toFixed(3));
root.style.setProperty('--s2ImgOpacity', s2Alpha.toFixed(3));
root.style.setProperty('--s3ImgOpacity', s3AlphaOut.toFixed(3));
root.style.setProperty('--s4ImgOpacity', s4Alpha.toFixed(3));

/* üü¢ Map opacity is now driven purely by scroll */
const mapAlpha = sMapAAlphaOut;
root.style.setProperty('--sMapAImgOpacity', mapAlpha.toFixed(3)); 

root.style.setProperty('--s5ImgOpacity', xMapA5.toFixed(3)); 
/* ... (rest of opacity updates S8 through S15 remain here) ... */
}

async function init(){
    /* ... (The boilerplate init and measurement code remains here) ... */
    
    // üü¢ 4. Initialize Mapbox GL JS map with provided credentials
    mapboxgl.accessToken = 'pk.eyJ1Ijoia2F2bmkiLCJhIjoiY2s5YjBqNGY1MGV4aTNobnk0amJncWZweCJ9.gZK_r9CYmb6ZN_mZVmgjNg';
    
    map = new mapboxgl.Map({
        container: 'mapbox-gl-container',
        style: 'mapbox://styles/kavni/cmhkpt4uz00et01pjheur1zc1',
        center: [34.770081, 32.079031], // Starting location (Geddes Civic Green area)
        zoom: 16.0, // Starting zoom
        pitch: 0, 
        interactive: true
    });

    // üí° CRITICAL: Disable scroll zoom to prevent it from stealing the page scroll.
    map.scrollZoom.disable(); 

    // You can re-enable it on a keypress for advanced users:
    // map.on('load', function() {
    //     map.getCanvas().addEventListener('mousedown', (e) => {
    //         if (e.ctrlKey || e.metaKey) {
    //             map.scrollZoom.enable();
    //         }
    //     });
    //     map.getCanvas().addEventListener('mouseup', () => {
    //         map.scrollZoom.disable();
    //     });
    // });
    
    // ... (rest of init calls) ...
    addEventListener('scroll', update, {passive:true});
    update();
}
// init(); 
// The init call should be uncommented in your final file.
})();
</script>
</body>
</html>
