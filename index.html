<!doctype html>
<html lang="en" data-baseline="stable-2025-10-01__rails-460px__galC-6-only">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gardenicity â€” Hero â†’ S1 â†’ S2 â†’ gallery-A-Left â†’ S3 â†’ S4 â†’ MapA â†’ S5 â†’ gallery-B-Center â†’ S8 â†’ S9 â†’ gallery-C-Right â†’ S11 â†’ S12 â†’ S13 â†’ S14 â†’ S15</title>
<style>

/* ===== Base (UNCHANGED) ===== */
html,body{
margin:0; padding:0; height:100%;
background:#f8fbf2; color:#fff;
font-family:"Acumin Pro",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
}
:root{
/* HERO */
--shift:0px; --titleOpacity:0; --linksOpacity:0; --heroAlpha:1; --heroBlur:0;
/* S1 */
--s1:0; --s1Overlay:0; --s1Y:0px; --s1ImgOpacity:0;
/* S2 */
--s2:0; --s2Overlay:0; --s2Y:0px; --s2ImgOpacity:0;
/* gallery-A-Left */
--galA:0;
--galAImg0Opacity:0; --galAImg1Opacity:0; --galAImg2Opacity:0; --galAImg3Opacity:0;
--galAReady:0;
/* S3 (full bleed) */
--s3:0; --s3ImgOpacity:0; --s3Scale:1;
/* S4 */
--s4:0; --s4Overlay:0; --s4Y:0px; --s4ImgOpacity:0;
/* NEW MAP SECTION */
--sMapA:0; --sMapAImgOpacity:0; --mapActive:0;
/* S5 */
--s5:0; --s5Overlay:0; --s5Y:0px; --s5ImgOpacity:0;
/* gallery-B-Center */
--galB:0;
--galBImg0Opacity:0; --galBImg1Opacity:0; --galBImg2Opacity:0; --galBImg3Opacity:0; --galBImg4Opacity:0;
--galBReady:0;
/* S8 (full bleed) */
--s8:0; --s8ImgOpacity:0; --s8Scale:1; --s8Ready:0;
/* S9 */
--s9:0; --s9Overlay:0; --s9Y:0px; --s9ImgOpacity:0;
/* gallery-C-Right (media left, no text) */
--galC:0;
--galCImg0Opacity:0; --galCImg1Opacity:0; --galCImg2Opacity:0; --galCImg3Opacity:0; --galCImg4Opacity:0; --galCImg5Opacity:0;
--galCReady:0;
/* S11 (left text / right image) */
--s11:0; --s11Overlay:0; --s11Y:0px; --s11ImgOpacity:0;
/* S12 (full bleed) */
--s12:0; --s12ImgOpacity:0; --s12Scale:1; --s12Ready:0;
/* S13 (like S1) */
--s13:0; --s13Overlay:0; --s13Y:0px; --s13ImgOpacity:0;
/* S14 (like S2) */
--s14:0; --s14Overlay:0; --s14Y:0px; --s14ImgOpacity:0;
/* S15 (full bleed + centered overlay) */
--s15:0; --s15Overlay:0; --s15Y:0px; --s15ImgOpacity:0; --s15Scale:1; --s15Ready:0;
}

/* ðŸŸ¢ CRITICAL: Lock scroll for interactive map */
body.body-locked{
overflow:hidden !important;
}

/* ... (Hero and other frame styles remain here) ... */

/* MapA full-bleed - CRITICAL STYLES */
.sMapA-frame{
    top:0; right:0; bottom:0; left:0;
    opacity:var(--sMapAImgOpacity);
    z-index: 1; 
}
.frame.sMapA-frame>iframe{
    width:100%; height:100%;
    object-fit:cover !important; object-position:center;
    /* Default: No interaction to allow scroll */
    pointer-events: none; 
}
/* ðŸŸ¢ CRITICAL: Enable interaction only when the body is locked */
body.body-locked .frame.sMapA-frame>iframe{
    pointer-events: auto; 
}

/* ðŸŸ¢ MODIFIED: Invisible Overlay to capture clicks */
.map-overlay{
    position:absolute; inset:0;
    z-index: 50; /* Above the iframe (z-index 1) */
    background: transparent;
    cursor:pointer;
    /* This makes it visually invisible but still able to capture clicks */
    opacity: 0; 
    pointer-events: auto; /* Default: Captures clicks */
    visibility: hidden; /* Default: Hidden until the map is scrolled into view */
}

/* Visible (to capture clicks) when map is cross-faded in AND not active */
.map-overlay[data-visible="true"][data-active="false"]{
    visibility: visible;
    pointer-events: auto;
}

/* Hidden when map is active: pointer-events are disabled so interaction passes through to iframe */
.map-overlay[data-active="true"],
.map-overlay[data-visible="false"]{
    pointer-events: none;
}


/* ðŸŸ¢ Exit button for when map is active/locked */
.exit-map-btn{
    position:fixed;
    top:32px; right:32px;
    z-index: 100; /* Highest z-index */
    padding:10px 20px;
    background:#00A86B;
    color:#fff;
    border:none;
    border-radius:4px;
    font-size:18px;
    cursor:pointer;
    opacity:var(--mapActive);
    pointer-events:none;
    transition:opacity .4s ease;
}
.exit-map-btn[data-active="true"]{
    pointer-events:auto;
}
.exit-map-btn:hover{
    background:#008B57;
}


/* ... (other frame styles S5, S8, S9, S11, S12, S13, S14, S15 remain here) ... */

/* ... (SECTION DRIVERS and TEXT OVERLAYS remain here) ... */

/* ===== MOBILE/TABLET RESPONSIVE (Map Overlay Fix) ===== */
@media (max-width:1023px){
    /* ðŸŸ¢ CRITICAL: Map frame must be full-bleed */
    .frame.sMapA-frame {
        left:0 !important; right:0 !important; top:0 !important; bottom:0 !important;
    }
    /* ðŸŸ¢ Map overlay and exit button must be fixed */
    .map-overlay, .exit-map-btn{
        position: fixed !important; 
    }
}
</style>
</head>
<body>

<figure class="frame s4-frame" aria-hidden="true"><img id="s4-img" src="assets/section4.jpg" alt=""></figure>
<section class="s4-wrap" id="s4-wrap"></section>
<div class="s4-overlay">
<div class="s4-rail">
<div class="s4-text" id="s4-text">
<p><strong>SECTION FOUR</strong> continues the close frameâ€¦</p>
<p>The left rail carries the narration forwardâ€¦</p>
<p>On the right, the image steadies the sceneâ€¦</p>
<p>Margins, rhythm, and pacing mirror Section Oneâ€¦</p>
<p>So the story breathes in familiar cadence.</p>
</div>
</div>
</div>

<figure class="frame sMapA-frame" aria-hidden="true" id="map-frame-container">
    <iframe id="sMapA-map" 
        src="https://api.mapbox.com/styles/v1/kavni/cmhkpt4uz00et01pjheur1zc1.html?title=false&access_token=pk.eyJ1Ijoia2F2bmkiLCJhIjoiY2s5YjBqNGY1MGV4aTNobnk0amJncWZweCJ9.gZK_r9CYmb6ZN_mZVmgjNg&zoomwheel=true#15.99/32.079031/34.770081" 
        title="Gardenicity-Geddes-Civic-Green" 
        style="border:none; width:100%; height:100%;" 
        allowfullscreen 
        allow="fullscreen"
    ></iframe>
    <div class="map-overlay" id="map-overlay" data-visible="false" data-active="false">
        </div>
</figure>
<button class="exit-map-btn" id="exit-map-btn" data-active="false">Exit Map (Continue Scroll)</button>

<section class="sMapA-wrap" id="sMapA-wrap"></section>

<script>
// ... (clamp, easeInOutCubic, easePow, measureHero, progressOf, all measureS functions, and load-gating functions remain here) ...
(function(){
const root=document.documentElement;
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const easeInOutCubic=t=>t<0.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;
const easePow=(t,p)=>Math.pow(t,p);

/* --- (measureHero, progressOf, all measureS functions, and load-gating functions remain here) --- */

/* ðŸŸ¢ MAP INTERACTION LOGIC (Interactive Hold) */
const body=document.body;
const mapOverlay=document.getElementById('map-overlay');
const exitMapBtn=document.getElementById('exit-map-btn');
let mapIsActive=false;

function enterMapInteraction(){
    if(!mapIsActive){
        mapIsActive=true;
        body.classList.add('body-locked');
        mapOverlay.setAttribute('data-active', 'true');
        exitMapBtn.setAttribute('data-active', 'true');
        root.style.setProperty('--mapActive', '1');
    }
}

function exitMapInteraction(){
    if(mapIsActive){
        mapIsActive=false;
        body.classList.remove('body-locked');
        mapOverlay.setAttribute('data-active', 'false');
        exitMapBtn.setAttribute('data-active', 'false');
        root.style.setProperty('--mapActive', '0');
    }
}

// ðŸŸ¢ Now a click anywhere on the invisible overlay activates the map
mapOverlay.addEventListener('click', enterMapInteraction); 
exitMapBtn.addEventListener('click', exitMapInteraction);

// ... (other measuring functions and load-gating functions would typically be repeated here, but they are omitted for brevity in the final output block) ...

function update(){
// ... (All existing progress calculations remain unchanged) ...

/* Progress */
// ... (s1 through s15 progress updates remain here) ...
const sMapA=progressOf(sMapAWrap); /* MAP */

// ... (All existing variable updates remain here) ...
root.style.setProperty('--sMapA',sMapA.toFixed(3)); /* MAP */
// ...

// ... (All existing text sweeps, end zooms, internal galleries logic remain here) ...

/* MapA â†’ S5 */
const xMapA5 = clamp(s5/FADE_FRAC, 0, 1);
const sMapAAlphaIn = clamp(sMapA/FADE_FRAC, 0, 1);
const sMapAAlphaOut = sMapAAlphaIn * (1 - xMapA5); 

/* ðŸŸ¢ Map Overlay Visibility Control (Controls when the invisible click target is active) */
// The overlay is visible for clicking when the map is cross-faded in, and not currently active/locked.
const mapVisible = (sMapAAlphaOut > 0.001) || (mapIsActive);
mapOverlay.setAttribute('data-visible', mapVisible ? 'true' : 'false');

// ... (rest of crossfade calculations S5 through S15 remain here) ...

/* ===== Apply section frame opacities (map opacity is controlled by sMapAAlphaOut) ===== */
// ... (opacities for S1, S2, S3, S4, S5, S8, S9, S11, S12, S13, S14, S15 remain here) ...

/* ðŸŸ¢ Map opacity is fixed to prevent flash when active, and set by crossfade otherwise */
const mapAlpha = mapIsActive ? 1.0 : sMapAAlphaOut;
root.style.setProperty('--sMapAImgOpacity', mapAlpha.toFixed(3)); 

// ...
}

async function init(){
// ... (The boilerplate init and measurement code remains here) ...
// The full logic for measurement would be here for a complete working file.
// ...
addEventListener('scroll', update, {passive:true});
update();
}
// init(); 
// The init call should be uncommented in the final complete file.
})();
</script>
</body>
</html>
