<!doctype html>
<html lang="en" data-baseline="stable-2025-10-01__rails-460px__galC-6-only">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gardenicity ‚Äî Hero ‚Üí S1 ‚Üí S2 ‚Üí gallery-A-Left ‚Üí S3 ‚Üí S4 ‚Üí MapA ‚Üí S5 ‚Üí gallery-B-Center ‚Üí S8 ‚Üí S9 ‚Üí gallery-C-Right ‚Üí S11 ‚Üí S12 ‚Üí S13 ‚Üí S14 ‚Üí S15</title>

<script src='https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.css' rel='stylesheet' />

<style>

/* ===== Base (UNCHANGED) ===== */
html,body{
margin:0; padding:0; height:100%;
background:#f8fbf2; color:#fff;
font-family:"Acumin Pro",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
}
:root{
/* HERO */
--shift:0px; --titleOpacity:0; --linksOpacity:0; --heroAlpha:1; --heroBlur:0;
/* S1 */
--s1:0; --s1Overlay:0; --s1Y:0px; --s1ImgOpacity:0;
/* S2 */
--s2:0; --s2Overlay:0; --s2Y:0px; --s2ImgOpacity:0;
/* gallery-A-Left */
--galA:0;
--galAImg0Opacity:0; --galAImg1Opacity:0; --galAImg2Opacity:0; --galAImg3Opacity:0;
--galAReady:0;
/* S3 (full bleed) */
--s3:0; --s3ImgOpacity:0; --s3Scale:1;
/* S4 */
--s4:0; --s4Overlay:0; --s4Y:0px; --s4ImgOpacity:0;
/* NEW MAP SECTION */
--sMapA:0; --sMapAImgOpacity:0; 
/* S5 */
--s5:0; --s5Overlay:0; --s5Y:0px; --s5ImgOpacity:0;
/* gallery-B-Center */
--galB:0;
--galBImg0Opacity:0; --galBImg1Opacity:0; --galBImg2Opacity:0; --galBImg3Opacity:0; --galBImg4Opacity:0;
--galBReady:0;
/* S8 (full bleed) */
--s8:0; --s8ImgOpacity:0; --s8Scale:1; --s8Ready:0;
/* S9 */
--s9:0; --s9Overlay:0; --s9Y:0px; --s9ImgOpacity:0;
/* gallery-C-Right (media left, no text) */
--galC:0;
--galCImg0Opacity:0; --galCImg1Opacity:0; --galCImg2Opacity:0; --galCImg3Opacity:0; --galCImg4Opacity:0; --galCImg5Opacity:0;
--galCReady:0;
/* S11 (left text / right image) */
--s11:0; --s11Overlay:0; --s11Y:0px; --s11ImgOpacity:0;
/* S12 (full bleed) */
--s12:0; --s12ImgOpacity:0; --s12Scale:1; --s12Ready:0;
/* S13 (like S1) */
--s13:0; --s13Overlay:0; --s13Y:0px; --s13ImgOpacity:0;
/* S14 (like S2) */
--s14:0; --s14Overlay:0; --s14Y:0px; --s14ImgOpacity:0;
/* S15 (full bleed + centered overlay) */
--s15:0; --s15Overlay:0; --s15Y:0px; --s15ImgOpacity:0; --s15Scale:1; --s15Ready:0;
}

/* ===== PINNED FRAMES (UNCHANGED) ===== */
figure.frame{ margin:0; }
.frame{
position:fixed; z-index:1; pointer-events:none;
display:flex; align-items:center; justify-content:center; overflow:hidden;
}
.frame img{ width:100%; height:100%; object-fit:contain; display:block; }

/* ... (S1, S2, GalA, S3, S4 frame styles remain here) ... */

/* MapA full-bleed - CRITICAL STYLES */
.sMapA-frame{
    top:0; right:0; bottom:0; left:0;
    opacity:var(--sMapAImgOpacity);
    z-index: 1; 
}
/* üü¢ Map container element (The Mapbox GL JS target) */
#mapbox-gl-container{
    width:100%; height:100%;
}
/* ‚ùå REMOVED: all iframe, map-overlay, and exit-map-btn CSS */

/* ===== SECTION DRIVERS (MapA inserted) ===== */
.s1-wrap, .s2-wrap, .galA-left-wrap, .s3-wrap, .s4-wrap,
.sMapA-wrap, /* NEW MAP WRAPPER */
.s5-wrap, .galB-center-wrap, .s8-wrap, .s9-wrap, .galC-left-wrap, .s11-wrap, .s12-wrap,
.s13-wrap, .s14-wrap, .s15-wrap{
position:relative; height:280vh; background:#f8fbf2;
}

/* ... (All other CSS remains here) ... */
</style>
</head>
<body>

<div class="hero-fixed" id="hero">...</div>
<section class="driver" id="driver"></section>
<figure class="frame s1-frame" aria-hidden="true"><img id="s1-img" src="assets/section1.jpg" alt="">
<div class="s1-overlay">...</div></figure>
<section class="s1-wrap" id="s1-wrap"></section>
<div class="s1-overlay">...</div>
<figure class="frame s2-frame" aria-hidden="true"><img id="s2-img" src="assets/section2.jpg" alt=""></figure>
<section class="s2-wrap" id="s2-wrap"></section>
<div class="s2-overlay">...</div>
<figure class="frame galA-left-frame" aria-hidden="true">...</figure>
<section class="galA-left-wrap" id="galA-wrap"></section>
<figure class="frame s3-frame" aria-hidden="true"><img id="s3-img" src="assets/section3.jpg" alt=""></figure>
<section class="s3-wrap" id="s3-wrap"></section>
<figure class="frame s4-frame" aria-hidden="true"><img id="s4-img" src="assets/section4.jpg" alt=""></figure>
<section class="s4-wrap" id="s4-wrap"></section>
<div class="s4-overlay">...</div>

<figure class="frame sMapA-frame" aria-hidden="true" id="map-frame-container">
    <div id="mapbox-gl-container"></div>
</figure>
<section class="sMapA-wrap" id="sMapA-wrap"></section>
<figure class="frame s5-frame" aria-hidden="true"><img id="s5-img" src="assets/section5.jpg" alt=""></figure>
<section class="s5-wrap" id="s5-wrap"></section>
<div class="s5-overlay">...</div>

<section class="after"></section>

<script>
(function(){
const root=document.documentElement;
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const easeInOutCubic=t=>t<0.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;
const easePow=(t,p)=>Math.pow(t,p);

/* ... (All measurement functions and helper functions remain here) ... */

function progressOf(el){
const r=el.getBoundingClientRect();
const vh=window.innerHeight||document.documentElement.clientHeight;
const total=r.height-vh;
if(total<=0) return 0;
return clamp(-r.top/total,0,1);
}

/* ---------- WRAPS ---------- */
const s1Wrap=document.getElementById('s1-wrap');
const s2Wrap=document.getElementById('s2-wrap');
const galAWrap=document.getElementById('galA-wrap');
const s3Wrap=document.getElementById('s3-wrap');
const s4Wrap=document.getElementById('s4-wrap');
const sMapAWrap=document.getElementById('sMapA-wrap'); /* MAP WRAP */
const s5Wrap=document.getElementById('s5-wrap');
const galBWrap=document.getElementById('galB-wrap');
const s8Wrap=document.getElementById('s8-wrap');
const s9Wrap=document.getElementById('s9-wrap');
const galCWrap=document.getElementById('galC-wrap');
const s11Wrap=document.getElementById('s11-wrap');
const s12Wrap=document.getElementById('s12-wrap');
const s13Wrap=document.getElementById('s13-wrap');
const s14Wrap=document.getElementById('s14-wrap');
const s15Wrap=document.getElementById('s15-wrap');

const s1Text=document.getElementById('s1-text');
const s2Text=document.getElementById('s2-text');
const s4Text=document.getElementById('s4-text');
const s5Text=document.getElementById('s5-text');
const s9Text=document.getElementById('s9-text');
const s11Text=document.getElementById('s11-text');
const s13Text=document.getElementById('s13-text');
const s14Text=document.getElementById('s14-text');
const s15Text=document.getElementById('s15-text');

let s1StartY=0, s1EndY=0;
let s2StartY=0, s2EndY=0;
let s4StartY=0, s4EndY=0;
let s5StartY=0, s5EndY=0;
let s9StartY=0, s9EndY=0;
let s11StartY=0, s11EndY=0;
let s13StartY=0, s13EndY=0;
let s14StartY=0, s14EndY=0;
let s15StartY=0, s15EndY=0;

function measureS1(){ const vh=window.innerHeight; const h=s1Text.scrollHeight; s1StartY=vh; s1EndY=-h; root.style.setProperty('--s1Y', s1StartY+'px'); }
function measureS2(){ const vh=window.innerHeight; const h=s2Text.scrollHeight; s2StartY=vh; s2EndY=-h; root.style.setProperty('--s2Y', s2StartY+'px'); }
function measureS4(){ const vh=window.innerHeight; const h=s4Text.scrollHeight; s4StartY=vh; s4EndY=-h; root.style.setProperty('--s4Y', s4StartY+'px'); }
function measureS5(){ const vh=window.innerHeight; const h=s5Text.scrollHeight; s5StartY=vh; s5EndY=-h; root.style.setProperty('--s5Y', s5StartY+'px'); }
function measureS9(){ const vh=window.innerHeight; const h=s9Text.scrollHeight; s9StartY=vh; s9EndY=-h; root.style.setProperty('--s9Y', s9StartY+'px'); }
function measureS11(){ const vh=window.innerHeight; const h=s11Text.scrollHeight; s11StartY=vh; s11EndY=-h; root.style.setProperty('--s11Y',(s11StartY+(s11EndY-s11StartY)*easePow(s11Raw,E))+'px'); }
function measureS13(){ const vh=window.innerHeight; const h=s13Text.scrollHeight; s13StartY=vh; s13EndY=-h; root.style.setProperty('--s13Y', s13StartY+'px'); }
function measureS14(){ const vh=window.innerHeight; const h=s14Text.scrollHeight; s14StartY=vh; s14EndY=-h; root.style.setProperty('--s14Y', s14StartY+'px'); }
function measureS15(){ const vh=window.innerHeight; const h=s15Text.scrollHeight; s15StartY=vh; s15EndY=-h; root.style.setProperty('--s15Y', s15StartY+'px'); }

/* ... (All load gates remain here) ... */
const s15Img = document.getElementById('s15-img');
function markS15Ready(){ root.style.setProperty('--s15Ready','1'); }
if (s15Img && s15Img.complete && s15Img.naturalWidth > 0) markS15Ready();
else if (s15Img) s15Img.addEventListener('load', markS15Ready, { once:true });

/* üü¢ MAPBOX GL JS GLOBAL VARIABLE */
let map = null; 

function update(){
/* ... (Hero choreography remains here) ... */

/* Progress */
const s1=progressOf(s1Wrap);
const s2=progressOf(s2Wrap);
const galA=progressOf(galAWrap);
const s3=progressOf(s3Wrap);
const s4=progressOf(s4Wrap);
const sMapA=progressOf(sMapAWrap); /* NEW */
const s5=progressOf(s5Wrap);
const galB=progressOf(galBWrap);
const s8=progressOf(s8Wrap);
const s9=progressOf(s9Wrap);
const galC=progressOf(galCWrap);
const s11=progressOf(s11Wrap);
const s12=progressOf(s12Wrap);
const s13=progressOf(s13Wrap);
const s14=progressOf(s14Wrap);
const s15=progressOf(s15Wrap);

root.style.setProperty('--s1',s1.toFixed(3));
root.style.setProperty('--s2',s2.toFixed(3));
root.style.setProperty('--galA',galA.toFixed(3));
root.style.setProperty('--s3',s3.toFixed(3));
root.style.setProperty('--s4',s4.toFixed(3));
root.style.setProperty('--sMapA',sMapA.toFixed(3)); /* NEW */
root.style.setProperty('--s5',s5.toFixed(3));
root.style.setProperty('--galB',galB.toFixed(3));
root.style.setProperty('--s8',s8.toFixed(3));
root.style.setProperty('--s9',s9.toFixed(3));
root.style.setProperty('--galC',galC.toFixed(3));
root.style.setProperty('--s11',s11.toFixed(3));
root.style.setProperty('--s12',s12.toFixed(3));
root.style.setProperty('--s13',s13.toFixed(3));
root.style.setProperty('--s14',s14.toFixed(3));
root.style.setProperty('--s15',s15.toFixed(3));

/* ... (Overlays, Text sweeps, End zooms logic remains here) ... */
const E=0.8;
const s1Raw=clamp((s1-0.75)/0.25,0,1); //...
const s2Raw=clamp((s2-0.25)/0.75,0,1); //...
const s4Raw=clamp((s4-0.75)/0.25,0,1); root.style.setProperty('--s4Y', (s4StartY +(s4EndY -s4StartY )*easePow(s4Raw,E))+'px');
const s5Raw=clamp((s5-0.25)/0.75,0,1); root.style.setProperty('--s5Y', (s5StartY +(s5EndY -s5StartY )*easePow(s5Raw,E))+'px');
//... (rest of text sweeps)

/* ===== Crossfades (standardized) ===== */
const FADE_FRAC = 0.35;
const LEAD_FRAC = 0.15;

/* ... (S1‚ÜíS2, S2‚ÜíGalA, GalA‚ÜíS3 logic remains here) ... */

/* S3 ‚Üí S4 */
const xA3 = clamp(s3/FADE_FRAC, 0, 1);
const s3Alpha = xA3;
const x34 = clamp(s4/FADE_FRAC, 0, 1);
const s3AlphaOut = s3Alpha * (1 - x34);
const s4In = x34;

/* S4 ‚Üí MapA */
const x4MapA = clamp(sMapA/FADE_FRAC, 0, 1);
const s4AlphaIn = s4In;
let sMapAAlphaIn = x4MapA;
let s4Alpha = s4AlphaIn * (1 - x4MapA); 

/* MapA ‚Üí S5 */
const xMapA5 = clamp(s5/FADE_FRAC, 0, 1);
const sMapAAlphaOut = sMapAAlphaIn * (1 - xMapA5); 
let s5Alpha = xMapA5; // S5 In

/* üü¢ Map Control Logic */
if (map && map.isStyleLoaded()) {
    // Scroll progress normalized from 0 to 1 across the MapA section wrapper
    const scrollProgress = clamp(sMapA, 0, 1);
    
    // START POSITION
    const startZoom = 16.0;
    const startCenter = [34.770081, 32.079031]; 
    
    // END POSITION
    const endZoom = 15.5;
    const endCenter = [34.775081, 32.075031]; 
    
    // Interpolate values based on scrollProgress
    const currentZoom = startZoom + (endZoom - startZoom) * scrollProgress;
    const currentLon = startCenter[0] + (endCenter[0] - startCenter[0]) * scrollProgress;
    const currentLat = startCenter[1] + (endCenter[1] - startCenter[1]) * scrollProgress;

    // Apply the position and zoom
    map.setZoom(currentZoom);
    map.setCenter([currentLon, currentLat]);
}
/* ----------------------------------------------- */

/* ... (rest of crossfade logic S5 through S15 remains here) ... */
const xB8 = clamp(s8/FADE_FRAC, 0, 1);
const s8Group = (getComputedStyle(root).getPropertyValue('--s8Ready')==='1') ? xB8 : 0;
const x89 = clamp(s9/FADE_FRAC, 0, 1);
const s8AlphaOut = s8Group * (1 - x89);

/* ===== Apply section frame opacities (using calculated variables) ===== */
root.style.setProperty('--s1ImgOpacity', s1Alpha.toFixed(3));
root.style.setProperty('--s2ImgOpacity', s2Alpha.toFixed(3));
root.style.setProperty('--s3ImgOpacity', s3AlphaOut.toFixed(3));
root.style.setProperty('--s4ImgOpacity', s4Alpha.toFixed(3));

/* üü¢ Map opacity is now driven purely by scroll */
const mapAlpha = sMapAAlphaOut;
root.style.setProperty('--sMapAImgOpacity', mapAlpha.toFixed(3)); 

root.style.setProperty('--s5ImgOpacity', s5Alpha.toFixed(3)); 
root.style.setProperty('--s8ImgOpacity', s8AlphaOut.toFixed(3));
// ... (rest of opacities) ...
}


async function init(){
    if(document.fonts && document.fonts.ready){ try{ await document.fonts.ready; }catch(e){} }
    measureHero();
    measureS1(); measureS2(); measureS4(); measureS5(); measureS9(); measureS11(); measureS13(); measureS14(); measureS15();
    
    // üü¢ 4. Initialize Mapbox GL JS map
    mapboxgl.accessToken = 'pk.eyJ1Ijoia2F2bmkiLCJhIjoiY2s5YjBqNGY1MGV4aTNobnk0amJncWZweCJ9.gZK_r9CYmb6ZN_mZVmgjNg';
    
    map = new mapboxgl.Map({
        container: 'mapbox-gl-container',
        style: 'mapbox://styles/kavni/cmhkpt4uz00et01pjheur1zc1',
        center: [34.770081, 32.079031], // Starting location
        zoom: 16.0, // Starting zoom
        pitch: 0, 
        interactive: true
    });

    // üí° CRITICAL: Disable default scroll zoom and drag pan
    map.scrollZoom.disable(); 
    map.dragPan.disable();
    
    // üí° OPTIONAL: Enable interaction only when Ctrl/Cmd is held (best for scrollytelling)
    map.on('load', function() {
        map.getCanvas().style.cursor = 'grab'; // Change cursor to indicate drag
        
        map.getCanvas().addEventListener('mousedown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                map.dragPan.enable();
                map.scrollZoom.enable();
                map.getCanvas().style.cursor = 'grabbing';
            }
        });
        map.getCanvas().addEventListener('mouseup', () => {
            map.dragPan.disable();
            map.scrollZoom.disable();
            map.getCanvas().style.cursor = 'grab';
        });
    });
    
    update();
    addEventListener('load',  ()=>{ measureHero(); measureS1(); measureS2(); measureS4(); measureS5(); measureS9(); measureS11(); measureS13(); measureS14(); measureS15(); update(); }, { once:true });
    addEventListener('resize',  ()=>{ measureHero(); measureS1(); measureS2(); measureS4(); measureS5(); measureS9(); measureS11(); measureS13(); measureS14(); measureS15(); update(); });
    addEventListener('scroll', update, {passive:true});
}
init();
})();
</script>
</body>
</html>
