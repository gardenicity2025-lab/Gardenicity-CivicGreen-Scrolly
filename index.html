MapboxGL V4
<!doctype html>
<html lang="en" data-baseline="stable-2025-10-01__rails-460px__galC-6-only">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gardenicity — Hero → S1 → S2 → gallery-A → Geddes → S3 → S4 → MapA (GL JS V4) → S5 → gallery-B → S8 → S9 → gallery-C → S11 → S12 → S13 → S14 → S15</title>

<link href="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.css" rel="stylesheet" />

<style>

/* ===== Base ===== */
html,body{
margin:0; padding:0; height:100%;
background:#f8fbf2; color:#fff;
font-family:"Acumin Pro",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
}
:root{
/* HERO */
--shift:0px; --titleOpacity:0; --linksOpacity:0; --heroAlpha:1; --heroBlur:0;
/* S1 */
--s1:0; --s1Overlay:0; --s1Y:0px; --s1ImgOpacity:0;
/* S2 */
--s2:0; --s2Overlay:0; --s2Y:0px; --s2ImgOpacity:0;
/* gallery-A-Left */
--galA:0;
--galAImg0Opacity:0; --galAImg1Opacity:0; --galAImg2Opacity:0; --galAImg3Opacity:0;
--galAReady:0;

/* NEW: GEDDES PLAN (Like S2) */
--sGeddes:0; --sGeddesOverlay:0; --sGeddesY:0px; --sGeddesImgOpacity:0;

/* S3 (full bleed) */
--s3:0; --s3ImgOpacity:0; --s3Scale:1;
/* S4 */
--s4:0; --s4Overlay:0; --s4Y:0px; --s4ImgOpacity:0;
/* NEW MAP SECTION */
--sMapA:0; --sMapAImgOpacity:0;
/* S5 */
--s5:0; --s5Overlay:0; --s5Y:0px; --s5ImgOpacity:0;
/* gallery-B-Center */
--galB:0;
--galBImg0Opacity:0; --galBImg1Opacity:0; --galBImg2Opacity:0; --galBImg3Opacity:0; --galBImg4Opacity:0;
--galBReady:0;
/* S8 (full bleed) */
--s8:0; --s8ImgOpacity:0; --s8Scale:1; --s8Ready:0;
/* S9 */
--s9:0; --s9Overlay:0; --s9Y:0px; --s9ImgOpacity:0;
/* gallery-C-Right (media left, no text) */
--galC:0;
--galCImg0Opacity:0; --galCImg1Opacity:0; --galCImg2Opacity:0; --galCImg3Opacity:0; --galCImg4Opacity:0; --galCImg5Opacity:0;
--galCReady:0;
/* S11 (left text / right image) */
--s11:0; --s11Overlay:0; --s11Y:0px; --s11ImgOpacity:0;
/* S12 (full bleed) */
--s12:0; --s12ImgOpacity:0; --s12Scale:1; --s12Ready:0;
/* S13 (like S1) */
--s13:0; --s13Overlay:0; --s13Y:0px; --s13ImgOpacity:0;
/* S14 (like S2) */
--s14:0; --s14Overlay:0; --s14Y:0px; --s14ImgOpacity:0;
/* S15 (full bleed + centered overlay) */
--s15:0; --s15Overlay:0; --s15Y:0px; --s15ImgOpacity:0; --s15Scale:1; --s15Ready:0;
}

/* ===== HERO (unchanged) ===== */
.hero-fixed{
position:fixed; inset:0; z-index:3;
opacity:var(--heroAlpha);
filter:blur(calc(var(--heroBlur)*10px));
pointer-events:auto; will-change:opacity,filter;
}
.hero-bg{
position:absolute; inset:0;
background:url("assets/hero1cg.jpg") center/cover no-repeat;
opacity:0; animation:heroIn 900ms ease-out forwards; pointer-events:none;
}
@keyframes heroIn{ from{opacity:0} to{opacity:1} }
.hero-media{
position:absolute; top:96px; bottom:96px; left:96px; right:82px;
display:flex; align-items:flex-end; justify-content:flex-start; overflow:hidden;
}
.col{ position:relative; max-width:700px; transform:translateY(var(--shift)); will-change:transform; }
.hero-title{ margin:0 0 24px 0; font-weight:400; font-size:100px; line-height:100px; opacity:var(--titleOpacity); }
.hero-title .line{ display:block; }
.hero-links{ display:flex; flex-direction:column; gap:10px; font-size:24px; line-height:30px; opacity:var(--linksOpacity); }
.hero-links a{ color:#fff; text-decoration:none; transition:color .2s ease; }
.hero-links a:hover,.hero-links a:focus-visible{ color:#00A86B; }
.driver{ height:200vh; }

/* ===== PINNED FRAMES ===== */
figure.frame { margin: 0; }

.frame {
  position: fixed;
  z-index: 1;
  pointer-events: none;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.frame img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
}

/* === MapA: base state (GL JS DIV) === */
.sMapA-frame {
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  opacity: var(--sMapAImgOpacity);
  z-index: 4;
}

/* === Map container (GL JS DIV) === */
#mapA-container { 
  width: 100%;
  height: 100%;
  position: relative; 
  /* Starts disabled, JS enables when visible */
  pointer-events: none;
}
/* IMPORTANT: Mapbox GL JS map container must have a fixed size */
.sMapA-frame, #mapA-container {
    width: 100%;
    height: 100%;
}

/* === When map active (visible) === */
.sMapA-frame.active #mapA-container {
  pointer-events: auto;
  z-index: 10 !important;
}

/* Optional debug outline */
.sMapA-frame.active {
  outline: 3px solid limegreen;
}

/* === Disable map when faded === */
.sMapA-frame[style*="opacity:0"] {
  pointer-events: none !important;
}

/* S1 image RIGHT (text left) */
.s1-frame {
  top: 96px;
  bottom: 96px;
  left: calc(96px + 460px + 96px);
  right: 82px;
  opacity: var(--s1ImgOpacity);
}

/* S2 image LEFT (mirror) */
.s2-frame{
top:96px; bottom:96px;
left: 96px;
right: calc(82px + 96px + 460px);
opacity: var(--s2ImgOpacity);
}

/* gallery-A-Left (right media area) */
.galA-left-frame{
top:96px; bottom:96px;
left: calc(96px + 460px + 96px);
right: 82px;
display:block;
}
.galA-left-frame img{
position:absolute; inset:0;
width:100%; height:100%;
object-fit:contain; object-position:center;
will-change:opacity;
}
#galA-img0{ opacity: var(--galAImg0Opacity); }
#galA-img1{ opacity: var(--galAImg1Opacity); }
#galA-img2{ opacity: var(--galAImg2Opacity); }
#galA-img3{ opacity: var(--galAImg3Opacity); }

/* NEW: GEDDES PLAN FRAME (Left Image, matches S2) */
.sGeddes-frame { top: 96px; bottom: 96px; left: 96px; right: calc(82px + 96px + 460px); opacity: var(--sGeddesImgOpacity); }

/* S3 full-bleed */
.s3-frame{ top:0; right:0; bottom:0; left:0; opacity:var(--s3ImgOpacity); }
.frame.s3-frame>img{
width:100%; height:100%;
object-fit:cover !important; object-position:center;
transform: scale(var(--s3Scale));
transform-origin: center center;
will-change: transform;
}

/* S4 image RIGHT */
.s4-frame{
top:96px; bottom:96px;
left: calc(96px + 460px + 96px);
right: 82px;
opacity: var(--s4ImgOpacity);
}

/* MapA full-bleed (MODIFIED FOR GL JS) */
.sMapA-frame{
    top:0; right:0; bottom:0; left:0;
    opacity:var(--sMapAImgOpacity);
}

/* S5 image LEFT */
.s5-frame{
top:96px; bottom:96px;
left: 96px;
right: calc(82px + 96px + 460px);
opacity: var(--s5ImgOpacity);
}

/* gallery-B-Center */
.galB-center-frame{
top:96px; bottom:96px; left:96px; right:82px;
display:block;
}
.galB-center-frame img{
position:absolute; inset:0;
width:100%; height:100%;
object-fit:contain; object-position:center;
will-change:opacity;
}
#galB-img0{ opacity: var(--galBImg0Opacity); }
#galB-img1{ opacity: var(--galBImg1Opacity); }
#galB-img2{ opacity: var(--galBImg2Opacity); }
#galB-img3{ opacity: var(--galBImg3Opacity); }
#galB-img4{ opacity: var(--galBImg4Opacity); }

/* S8 full-bleed */
.s8-frame{ top:0; right:0; bottom:0; left:0; opacity:var(--s8ImgOpacity); }
.frame.s8-frame>img{
width:100%; height:100%;
object-fit:cover !important; object-position:center;
transform: scale(var(--s8Scale));
transform-origin: center center;
will-change: transform;
}

/* S9 image RIGHT (like S1/S4) */
.s9-frame{
top:96px; bottom:96px;
left: calc(96px + 460px + 96px);
right: 82px;
opacity: var(--s9ImgOpacity);
}

/* gallery-C-Right (media on LEFT, no text) */
.galC-left-frame{
top:96px; bottom:96px;
left: 96px;
right: calc(82px + 96px + 460px);
display:block;
}
.galC-left-frame img{
position:absolute; inset:0;
width:100%; height:100%;
object-fit:contain; object-position:center;
will-change:opacity;
}
#galC-img0{ opacity: var(--galCImg0Opacity); }
#galC-img1{ opacity: var(--galCImg1Opacity); }
#galC-img2{ opacity: var(--galCImg2Opacity); }
#galC-img3{ opacity: var(--galCImg3Opacity); }
#galC-img4{ opacity: var(--galCImg4Opacity); }
#galC-img5{ opacity: var(--galCImg5Opacity); }

/* S11 image RIGHT (like S1/S4/S9) */
.s11-frame{
top:96px; bottom:96px;
left: calc(96px + 460px + 96px);
right: 82px;
opacity: var(--s11ImgOpacity);
}

/* S12 full-bleed */
.s12-frame{ top:0; right:0; bottom:0; left:0; opacity:var(--s12ImgOpacity); }
.frame.s12-frame>img{
width:100%; height:100%;
object-fit:cover !important; object-position:center;
transform: scale(var(--s12Scale));
transform-origin: center center;
will-change: transform;
}

/* S13 image RIGHT (like S1) */
.s13-frame{
top:96px; bottom:96px;
left: calc(96px + 460px + 96px);
right: 82px;
opacity: var(--s13ImgOpacity);
}

/* S14 image LEFT (like S2) */
.s14-frame{
top:96px; bottom:96px;
left: 96px;
right: calc(82px + 96px + 460px);
opacity: var(--s14ImgOpacity);
}

/* S15 full-bleed */
.s15-frame{ top:0; right:0; bottom:0; left:0; opacity:var(--s15ImgOpacity); }
.frame.s15-frame>img{
width:100%; height:100%;
object-fit:cover !important; object-position:center;
transform: scale(var(--s15Scale));
transform-origin: center center;
will-change: transform;
}

/* ===== SECTION DRIVERS ===== */
.s1-wrap, .s2-wrap, .galA-left-wrap,
.sGeddes-wrap, /* NEW */
.s3-wrap, .s4-wrap, .s5-wrap,
.sMapA-wrap, /* NEW */
.galB-center-wrap, .s8-wrap, .s9-wrap, .galC-left-wrap, .s11-wrap, .s12-wrap,
.s13-wrap, .s14-wrap, .s15-wrap{
position:relative; height:280vh; background:#f8fbf2;
}

/* ===== TEXT OVERLAYS (rails) ===== */
.s1-overlay, .s2-overlay, .sGeddes-overlay, .s4-overlay, .s5-overlay, .s9-overlay, .s11-overlay, .s13-overlay, .s14-overlay, .s15-overlay{
position:fixed; inset:0; z-index:2; pointer-events:none;
}
.s1-overlay{ opacity:var(--s1Overlay); }
.s2-overlay{ opacity:var(--s2Overlay); }
.sGeddes-overlay{ opacity:var(--sGeddesOverlay); } /* NEW */
.s4-overlay{ opacity:var(--s4Overlay); }
.s5-overlay{ opacity:var(--s5Overlay); }
.s9-overlay{ opacity:var(--s9Overlay); }
.s11-overlay{ opacity:var(--s11Overlay); }
.s13-overlay{ opacity:var(--s13Overlay); }
.s14-overlay{ opacity:var(--s14Overlay); }
.s15-overlay{ opacity:var(--s15Overlay); }

/* LEFT rails (text left) */
.s1-rail, .s4-rail, .s9-rail, .s11-rail, .s13-rail{
position:absolute; top:0; bottom:0; left:96px; width:460px; overflow:hidden;
}

/* RIGHT rails (text right) */
.s2-rail, .sGeddes-rail, .s5-rail, .s14-rail{
position:absolute; top:0; bottom:0; right:96px; width:460px; overflow:hidden;
}

.s1-text{ transform:translateY(var(--s1Y)); color:#111; }
.s2-text{ transform:translateY(var(--s2Y)); color:#111; text-align:left; }
.sGeddes-text{ transform:translateY(var(--sGeddesY)); color:#111; text-align:left; } /* NEW */
.s4-text{ transform:translateY(var(--s4Y)); color:#111; }
.s5-text{ transform:translateY(var(--s5Y)); color:#111; text-align:left; }
.s9-text{ transform:translateY(var(--s9Y)); color:#111; }
.s11-text{ transform:translateY(var(--s11Y)); color:#111; }
.s13-text{ transform:translateY(var(--s13Y)); color:#111; }
.s14-text{ transform:translateY(var(--s14Y)); color:#111; text-align:left; }

/* ===== S15: CENTER COLUMN OVERLAY (centered text) ===== */
.s15-rail{
position:absolute; top:0; bottom:0;
left:50%; transform:translateX(-50%);
width:700px; max-width:calc(100vw - 96px - 82px);
overflow:hidden;
}
.s15-text{
transform:translateY(var(--s15Y));
color:#fff; text-align:center;
}
.s1-text p, .s2-text p, .sGeddes-text p, .s4-text p, .s5-text p, .s9-text p, .s11-text p, .s13-text p, .s14-text p, .s15-text p{
margin:0 0 14px 0; font-size:20px; line-height:28px;
}
.after{ min-height:120vh; }

/* ===== PATCH: Enable S15 links only in S15 ===== */
.s15-overlay{
z-index:3;
pointer-events:none;
}
.s15-overlay[style*="opacity: 1"] {
pointer-events:auto;
}
.s15-text{
position:relative;
z-index:4;
pointer-events:auto;
}
.s15-text a{
color:#fff;
text-decoration:none;
transition:color .2s ease;
position:relative;
z-index:5;
}
.s15-text a:hover,
.s15-text a:focus-visible{
color:#00A86B;
}
/*
=====================================================
MOBILE RESPONSIVE (max-width:600px) - DEDICATED MOBILE VIEW
=====================================================
*/
@media (max-width:600px){
body {
margin:0;
padding:0;
background:#f8fbf2;
}

/* ==== HERO (No changes) ==== */
.hero-media {
top:20px; bottom:20px; left:20px; right:20px;
}
.hero-title {
font-size:72px;
line-height:1.05;
}
.hero-links {
font-size:20px;
line-height:26px;
}

/* ==== SECTION WRAPS (No changes) ==== */
.s1-wrap, .s2-wrap, .sGeddes-wrap, .s4-wrap, .s5-wrap,
.s9-wrap, .s11-wrap, .s13-wrap, .s14-wrap {
position:relative;
min-height:200vh;
background:#f8fbf2;
}

/* ==== SECTION IMAGES (No changes) ==== */
.s1-frame, .s2-frame, .sGeddes-frame, .s4-frame, .s5-frame,
.s9-frame, .s11-frame, .s13-frame, .s14-frame {
position:fixed;
top:20px; bottom:20px; left:20px; right:20px;
display:flex;
align-items:center;
justify-content:center;
z-index:1;
pointer-events:none;
}
.s1-frame img, .s2-frame img, .sGeddes-frame img, .s4-frame img, .s5-frame img,
.s9-frame img, .s11-frame img, .s13-frame img, .s14-frame img {
width:100%;
height:auto;
object-fit:contain;
display:block;
}

/* ==== TEXT OVERLAY (Base Structure & BACKGROUND) ==== */
.s1-overlay, .s2-overlay, .sGeddes-overlay, .s4-overlay, .s5-overlay,
.s9-overlay, .s11-overlay, .s13-overlay, .s14-overlay, .s15-overlay {
position:relative !important;
opacity:1 !important;
pointer-events:auto !important;
transform:none !important;
padding:0 20px 80px; /* Base padding */
max-width:100% !important; /* Full width */
margin:0 auto;
background:#f8fbf2 !important; /* Base background for S1-S14 */
z-index:2;
}

/* S15 Overlay Overrides */
.s15-overlay {
background: transparent !important;
max-width: 100% !important;
padding: 80px 20px 80px !important; /* 80px Top/Bottom, 20px Left/Right */
margin: 0 auto !important;
position: relative !important;
z-index: 5 !important;
}

/* S15 Rail Structural Reset */
.s1-rail, .s2-rail, .sGeddes-rail, .s4-rail, .s5-rail,
.s9-rail, .s11-rail, .s13-rail, .s14-rail, .s15-rail {
position:relative !important;
width:100% !important;
margin:0 !important;
left:auto !important;
right:auto !important;
transform: none !important;
}
.s15-rail {
left: 0 !important;
right: 0 !important;
transform: none !important;
margin: 0 auto !important;
}


/* ==== TEXT (Margins & Color) ==== */
.s1-text, .s2-text, .sGeddes-text, .s4-text, .s5-text,
.s9-text, .s11-text, .s13-text, .s14-text, .s15-text {
transform:none !important;
color:#111;
text-align:left;
font-size:18px;
line-height:26px;
margin:80px 0 80px 0;
}

/* S15 Text and Link Styling */
.s15-text {
color:#fff !important;
text-align:center !important;
padding:0 !important;
margin: 80px auto 80px auto !important;
max-width: 100% !important;
width: 100% !important;

position: relative !important;
left: 50% !important;
transform: translateX(-50%) !important;
}

/* S15 Link Fixes */
.s15-text a {
color:#fff !important;
text-decoration: none !important;
transition: color .2s ease;
display: inline-block !important;
position: relative !important;
z-index: 100 !important;
}
.s15-text a:hover, .s15-text a:focus, .s15-text a:focus-visible, .s15-text a:active {
color: #00A86B !important;
opacity: 1 !important;
}


/* ==== GALLERIES & FULL BLEEDS (Updated to include MapA) ==== */
.galA-left-frame, .galB-center-frame, .galC-left-frame {
left:20px; right:20px;
}
.frame.s3-frame, .frame.s8-frame, .frame.s12-frame, .frame.s15-frame, .frame.sMapA-frame {
left:0; right:0; top:0; bottom:0;
}
}
/*
=====================================================
TABLET RESPONSIVE (min-width:601px and max-width:1023px) - FINAL FIXES + DYNAMIC HERO TEXT
=====================================================
*/
@media (min-width:601px) and (max-width:1023px) {

/* Hero Text Scaling (New Addition) */
.hero-title {
/* Title remains Dynamic and scales smoothly */
font-size: clamp(80px, 12vw, 100px) !important;
line-height: 1.05 !important;
}
.hero-links {
/* Links are now Static (Fixed Jump) for predictability */
font-size: 24px !important;
line-height: 28px !important;
}

/* Structural & Containment Fixes (From previous successful steps) */

/* 1. Ensure sections are scrollable and have background */
.s1-wrap, .s2-wrap, .sGeddes-wrap, .s4-wrap, .s5-wrap,
.s9-wrap, .s11-wrap, .s13-wrap, .s14-wrap {
min-height: 200vh !important;
background: #f8fbf2 !important;
}

/* 2. Base content wrappers are restricted and centered (Text/Overlay Column) */
.s1-overlay, .s2-overlay, .sGeddes-overlay, .s4-overlay, .s5-overlay,
.s9-overlay, .s11-overlay, .s13-overlay, .s14-overlay, .s15-overlay {
max-width: 600px !important;
padding:0 !important;
margin:0 auto !important;
background:#f8fbf2 !important;
position: relative !important;
opacity: 1 !important;
pointer-events: auto !important;
transform: none !important;
}
.s15-overlay {
background: transparent !important;
padding: 80px 0 80px 0 !important;
z-index: 5 !important;
}

/* 3. Section Images - Constrain them to the 600px column */
.s1-frame, .s2-frame, .sGeddes-frame, .s4-frame, .s5-frame,
.s9-frame, .s11-frame, .s13-frame, .s14-frame {
position: absolute !important;
left: 50% !important;
transform: translateX(-50%) !important;
width: 600px !important;
margin: 0 auto !important;
top: 0 !important; bottom: 0 !important;
padding: 20px !important;
}

/* 4. Text Rail and Inner Text */
.s1-text, .s2-text, .sGeddes-text, .s4-text, .s5-text, .s9-text, .s11-text, .s13-text, .s14-text, .s15-text {
padding: 0 20px !important;
margin: 80px auto 80px auto !important;
left: auto !important;
transform: none !important;
max-width: 100% !important;
width: auto !important;
text-align: left !important;
}
/* S15 Text (Centering Fix) */
.s15-text {
text-align: center !important;
color: #fff !important;
left: 50% !important;
transform: translateX(-50%) !important;
}

/* 5. Galleries and Full-bleed remain full-bleed */
.galA-left-frame, .galB-center-frame, .galC-left-frame {
  /* No change, they naturally expand to fill the area around the text rail */
}

.frame.s3-frame, .frame.s8-frame, .frame.s12-frame, .frame.s15-frame, .frame.sMapA-frame {
  left: 0 !important;
  right: 0 !important;
}

/* === Global scroll restore === */
body, html {
  overscroll-behavior: auto;
}

/* Prevent invisible fixed frames (like MapA when faded) from blocking mouse scroll */
.frame[style*="opacity:0"],
.frame[style*="opacity: 0"] {
  pointer-events: none !important;
}

</style>
</head>
<body>

<div class="hero-fixed" id="hero">
<div class="hero-bg" aria-hidden="true"></div>
<div class="hero-media" id="hero-media">
<div class="col" id="hero-col">
<h1 class="hero-title" id="hero-title">
<span class="line">Gardenicity</span>
<span class="line">Civic Green</span>
</h1>
<nav class="hero-links" id="hero-links" aria-label="Primary">
<a href="https://www.megama.net">What Did Geddes See</a>
<a href="https://www.megama.net">Growth</a>
<a href="https://www.megama.net">Sustenance</a>
<a href="https://www.megama.net">Leafy SDGs</a>
<a href="https://www.megama.net">EN/עב</a>
</nav>
</div>
</div>
</div>

<section class="driver" id="driver"></section>

<figure class="frame s1-frame" aria-hidden="true"><img id="s1-img" src="assets/section1.jpg" alt=""></figure>
<figure class="frame s2-frame" aria-hidden="true"><img id="s2-img" src="assets/section2.jpg" alt=""></figure>

<figure class="frame galA-left-frame" aria-hidden="true">
<img id="galA-img0" src="assets/gallery-A.jpg" alt="">
<img id="galA-img1" src="assets/gallery-A1.jpg" alt="">
<img id="galA-img2" src="assets/gallery-A2.jpg" alt="">
<img id="galA-img3" src="assets/gallery-A3.jpg" alt="">
</figure>

<figure class="frame sGeddes-frame" aria-hidden="true"><img id="sGeddes-img" src="assets/geddesplan.jpg" alt=""></figure>

<figure class="frame s3-frame" aria-hidden="true"><img id="s3-img" src="assets/section3.jpg" alt=""></figure>
<figure class="frame s4-frame" aria-hidden="true"><img id="s4-img" src="assets/section4.jpg" alt=""></figure>

<figure class="frame sMapA-frame" aria-hidden="true">
    <div id="mapA-container"></div>
</figure>
<figure class="frame s5-frame" aria-hidden="true"><img id="s5-img" src="assets/section5.jpg" alt=""></figure>

<figure class="frame galB-center-frame" aria-hidden="true">
<img id="galB-img0" src="assets/gallery-B.jpg" alt="">
<img id="galB-img1" src="assets/gallery-B1.jpg" alt="">
<img id="galB-img2" src="assets/gallery-B2.jpg" alt="">
<img id="galB-img3" src="assets/gallery-B3.jpg" alt="">
<img id="galB-img4" src="assets/gallery-B4.jpg" alt="">
</figure>

<figure class="frame s8-frame" aria-hidden="true">
<img id="s8-img" src="assets/section8.jpg" alt="">
</figure>

<figure class="frame s9-frame" aria-hidden="true"><img id="s9-img" src="assets/section9.jpg" alt=""></figure>

<figure class="frame galC-left-frame" aria-hidden="true">
<img id="galC-img0" src="assets/gallery-C.jpg" alt="">
<img id="galC-img1" src="assets/gallery-C1.jpg" alt="">
<img id="galC-img2" src="assets/gallery-C2.jpg" alt="">
<img id="galC-img3" src="assets/gallery-C3.jpg" alt="">
<img id="galC-img4" src="assets/gallery-C4.jpg" alt="">
<img id="galC-img5" src="assets/gallery-C5.jpg" alt="">
</figure>

<figure class="frame s11-frame" aria-hidden="true"><img id="s11-img" src="assets/section11.jpg" alt=""></figure>

<figure class="frame s12-frame" aria-hidden="true">
<img id="s12-img" src="assets/section12.jpg" alt="">
</figure>

<figure class="frame s13-frame" aria-hidden="true"><img id="s13-img" src="assets/section13.jpg" alt=""></figure>

<figure class="frame s14-frame" aria-hidden="true"><img id="s14-img" src="assets/section14.jpg" alt=""></figure>

<figure class="frame s15-frame" aria-hidden="true">
<img id="s15-img" src="assets/section15.jpg" alt="">
</figure>

<section class="s1-wrap" id="s1-wrap"></section>
<div class="s1-overlay">
<div class="s1-rail">
<div class="s1-text" id="s1-text">
<p><strong>HOURS AFTER MY</strong> mother took her last breath on earth…</p>
<p>After we opened the windows to let the spirits out…</p>
<p>After we lit incense stick after incense stick…</p>
<p>After we watched MMA fighters on TV in the basement…</p>
<p>And the smoke kept rising. The chain must not be broken. **\*Lorem ipsum dolor sit amet, consectetur adipiscing elit.
Aliquam varius, metus nec tincidunt tincidunt, nunc erat tincidunt sapien, vel laoreet lacus nisi eget justo. Nullam ut placerat odio.
Nulla vitae eros nec mi rutrum eleifend at nec dui. Duis ultricies consequat lobortis.
Fusce a aliquam lorem, ac lacinia est. Praesent rutrum odio eget tellus mattis, at malesuada lorem dapibus.
Pellentesque accumsan dui a lectus porttitor vestibulum. Nam venenatis urna elit, at condimentum eros elementum interdum. Proin sed semper nulla.
Mauris placerat non dui at pretium. Ut aliquam tellus ipsum, non porta ex congue a.
Vestibulum molestie egestas tellus, vitae tincidunt nibh mollis nec.
Fusce quis magna elit. Aenean mi tellus, fermentum eu pharetra id, fermentum non turpis. **\*</p>
</div>
</div>
</div>

<section class="s2-wrap" id="s2-wrap"></section>
<div class="s2-overlay">
<div class="s2-rail">
<div class="s2-text" id="s2-text">
<p><strong>SECTION TWO</strong> opens as the previous memory fades…</p>
<p>Now the perspective widens to a new frame…</p>
<p>The city’s edge meets the garden…</p>
<p>We follow the lines of growth and care…</p>
<p>And learn how places hold time. **\*Lorem ipsum dolor sit amet, consectetur adipiscing elit.
Aliquam varius, metus nec tincidunt tincidunt, nunc erat tincidunt sapien, vel laoreet lacus nisi eget justo. Nullam ut placerat odio.
Nulla vitae eros nec mi rutrum eleifend at nec dui. Duis ultricies consequat lobortis.
Fusce a aliquam lorem, ac lacinia est. Praesent rutrum odio eget tellus mattis, at malesuada lorem dapibus.
Pellentesque accumsan dui a lectus porttitor vestibulum. Nam venenatis urna elit, at condimentum eros elementum interdum. Proin sed semper nulla.
Mauris placerat non dui at pretium. Ut aliquam tellus ipsum, non porta ex congue a.
Vestibulum molestie egestas tellus, vitae tincidunt nibh mollis nec.
Fusce quis magna elit. Aenean mi tellus, fermentum eu pharetra id, fermentum non turpis. **\*</p>
</div>
</div>
</div>

<section class="galA-left-wrap" id="galA-wrap"></section>

<section class="sGeddes-wrap" id="sGeddes-wrap"></section>
<div class="sGeddes-overlay">
  <div class="sGeddes-rail">
    <div class="sGeddes-text" id="sGeddes-text">
      <p><strong>GEDDES PLAN</strong></p>
      <p>Your text content for the Geddes Plan goes here...</p>
      <p>It behaves exactly like Section 2 (Right Rail / Left Image).</p>
    </div>
  </div>
</div>

<section class="s3-wrap" id="s3-wrap"></section>

<section class="s4-wrap" id="s4-wrap"></section>
<div class="s4-overlay">
<div class="s4-rail">
<div class="s4-text" id="s4-text">
<p><strong>SECTION FOUR</strong> returns to the tight frame…</p>
<p>Left-rail narration continues the thread…</p>
<p>The horizontal image sits steady at right…</p>
<p>Margins and rhythm match Section One…</p>
<p>And the cycle of views goes on.</p>
</div>
</div>
</div>

<section class="sMapA-wrap" id="sMapA-wrap"></section>
<section class="s5-wrap" id="s5-wrap"></section>
<div class="s5-overlay">
<div class="s5-rail">
<div class="s5-text" id="s5-text">
<p><strong>SECTION FIVE</strong> shifts the rail again…</p>
<p>Now the narration hugs the right margin…</p>
<p>While the image holds the left field of view…</p>
<p>Framing the next turn in the story…</p>
<p>With the same cadence and pace.</p>
</div>
</div>
</div>

<section class="galB-center-wrap" id="galB-wrap"></section>

<section class="s8-wrap" id="s8-wrap"></section>

<section class="s9-wrap" id="s9-wrap"></section>
<div class="s9-overlay">
<div class="s9-rail">
<div class="s9-text" id="s9-text">
<p><strong>SECTION NINE</strong> brings us back to the close frame…</p>
<p>The left rail carries the narration forward…</p>
<p>On the right, the image steadies the scene…</p>
<p>Margins, rhythm, and pacing mirror Section One…</p>
<p>So the story breathes in familiar cadence.</p>
</div>
</div>
</div>

<section class="galC-left-wrap" id="galC-wrap"></section>

<section class="s11-wrap" id="s11-wrap"></section>
<div class="s11-overlay">
<div class="s11-rail">
<div class="s11-text" id="s11-text">
<p><strong>SECTION ELEVEN</strong> continues the thread…</p>
<p>Back to the left rail; image anchors the right…</p>
<p>Margins and rhythm unchanged…</p>
<p>Standard crossfades keep the cadence…</p>
<p>As the story settles into focus.</p>
</div>
</div>
</div>

<section class="s12-wrap" id="s12-wrap"></section>

<section class="s13-wrap" id="s13-wrap"></section>
<div class="s13-overlay">
<div class="s13-rail">
<div class="s13-text" id="s13-text">
<p><strong>SECTION THIRTEEN</strong> returns to the close frame…</p>
<p>Left-rail narration pulls us forward…</p>
<p>The right-side image steadies the scene…</p>
<p>Margins and rhythm echo Section One…</p>
<p>Breathing at the familiar pace.</p>
</div>
</div>
</div>

<section class="s14-wrap" id="s14-wrap"></section>
<div class="s14-overlay">
<div class="s14-rail">
<div class="s14-text" id="s14-text">
<p><strong>SECTION FOURTEEN</strong> flips the rail…</p>
<p>Text to the right, image to the left…</p>
<p>Pacing and fades match Section Two…</p>
<p>As the view widens and settles…</p>
<p>Into the next cadence.</p>
</div>
</div>
</div>

<section class="s15-wrap" id="s15-wrap"></section>
<div class="s15-overlay">
<div class="s15-rail">
<div class="s15-text" id="s15-text">
<p><strong>Gardenicity</strong> Writing, Design, Curation:<br>
Megama/Rebecca Sternberg, Keren Avni</p>
<p><strong>Photo Credits:</strong><br>
1 - Survey of Israel (MAPI); 2-10, 15-25 - Matson (G. Eric and Edith) Photograph Collection, LOC;
11-14 - NLI Boris Carmi; 26 - Tomer Appelbaum</p>
<p>
<a href="https://www.megama.net" target="_blank">Gardencity what did Geddes See?</a><br>
<a href="https://www.megama.net" target="_blank">Civic Green</a><br>
<a href="https://www.megama.net" target="_blank">Growth</a><br>
<a href="https://www.megama.net" target="_blank">Leafy SDGs</a><br>
<a href="https://www.megama.net" target="_blank">EN/עב</a>
</p>
</div>
</div>
</div>

<section class="after"></section>

<script src="https://api.mapbox.com/mapbox-gl-js/v3.1.2/mapbox-gl.js"></script>
<script>
mapboxgl.accessToken = 'pk.eyJ1Ijoia2F2bmkiLCJhIjoiY2s5YjBqNGY1MGV4aTNobnk0amJncWZweCJ9.gZK_r9CYmb6ZN_mZVmgjNg';

const MAP_START_CENTER = [34.770081, 32.079031]; // Lon, Lat
// Define the boundaries the map cannot scroll beyond
const MAP_MIN_ZOOM = 13; 
const MAP_MAX_ZOOM = 18; 
const MAP_START_ZOOM = 15.99;

const mapFrame = document.querySelector('.sMapA-frame');
const mapContainer = document.getElementById('mapA-container');
const mapSection = document.querySelector('#sMapA-wrap');

// Initialize the Mapbox GL JS Map
const map = new mapboxgl.Map({
    container: 'mapA-container',
    style: 'mapbox://styles/kavni/cmhkpt4uz00et01pjheur1zc1',
    center: MAP_START_CENTER,
    zoom: MAP_START_ZOOM,
    minZoom: MAP_MIN_ZOOM, // Enforce Mapbox minimum limit
    maxZoom: MAP_MAX_ZOOM, // Enforce Mapbox maximum limit
    interactive: false 
});

// Helper function to disable all map user interactions
function disableMapInteractions() {
    map.scrollZoom.disable();
    map.dragPan.disable();
    map.doubleClickZoom.disable();
    map.touchZoomRotate.disable();
}

// Helper function to enable all map user interactions
function enableMapInteractions() {
    // Only enable scrollZoom if the map is within the page's visible area
    const rect = mapSection.getBoundingClientRect();
    const visible = rect.top < window.innerHeight * 0.8 && rect.bottom > window.innerHeight * 0.2;
    
    if (visible) {
        map.scrollZoom.enable();
        map.dragPan.enable();
        map.doubleClickZoom.enable();
        map.touchZoomRotate.enable();
    }
}

map.on('load', () => {
    disableMapInteractions();
});

// 1. Zoom Boundary Check (THE CORE FIX for scroll-out)
// If the map hits a zoom limit (MAP_MIN_ZOOM or MAP_MAX_ZOOM), 
// it disables its own scrollZoom, allowing the scroll event to 'bubble up' to the page.
map.on('zoomend', () => {
    const currentZoom = map.getZoom();

    if (currentZoom <= MAP_MIN_ZOOM || currentZoom >= MAP_MAX_ZOOM) {
        map.scrollZoom.disable();
    } 
    // Other interactions (pan, etc.) remain enabled until mouseleave
});


// 2. Global Visibility Toggle (Standard Scrollytelling control - Simplified)
function toggleMapPointer() {
    if (!mapFrame || !mapSection) return;

    const rect = mapSection.getBoundingClientRect();
    // Check if the map section is roughly 80% visible
    const visible = rect.top < window.innerHeight * 0.8 && rect.bottom > window.innerHeight * 0.2;
    
    // Check if the cursor is currently inside the map container
    const isCursorInside = mapContainer.matches(':hover');

    if (visible) {
        mapFrame.classList.add('active');
        
        // This is now handled entirely by mouseenter/mouseleave below
        if (isCursorInside) {
             // If cursor is inside, the mouseenter event will handle enabling
        } else {
             // If visible but cursor isn't here, keep interactions disabled
             disableMapInteractions();
        }

    } else {
        mapFrame.classList.remove('active');
        // Always disable all interactions when the section is not visible
        disableMapInteractions();
    }
}


// 3. Mouse Interaction Control (Fixes the original scroll trap)
mapContainer.addEventListener('mouseleave', () => {
    if (map) {
        disableMapInteractions(); // Disable ALL interactions immediately on exit
    }
});

mapContainer.addEventListener('mouseenter', () => {
    if (map) {
        // Re-enable all interactions ONLY if the section is visible
        const rect = mapSection.getBoundingClientRect();
        const visible = rect.top < window.innerHeight * 0.8 && rect.bottom > window.innerHeight * 0.2;
        
        if (visible) {
            enableMapInteractions(); // Enables all interactions when cursor enters
        }
    }
});


// Add listeners for the main scrollytelling control
window.addEventListener('scroll', toggleMapPointer, { passive: true });
window.addEventListener('resize', toggleMapPointer);

// Initial call to set the correct state
map.on('render', toggleMapPointer);
toggleMapPointer();
</script>

</body>
</html>
